<app-sidebar></app-sidebar>
<div class="home-section lg:ml-64">
  <!-- Back Button -->
  <div class="back-section">
    <button pButton type="button"
            icon="pi pi-arrow-left"
            label="Back to Stores"
            class="p-button-outlined"
            (click)="goBack()">
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <i class="pi pi-spin pi-spinner" style="font-size: 2rem; margin-bottom: 1rem;"></i>
    <div>Loading store details...</div>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-container">
    <i class="pi pi-exclamation-triangle" style="font-size: 2rem; color: #f44336; margin-bottom: 1rem;"></i>
    <div>Store not found or failed to load</div>
    <button pButton type="button" label="Back to Stores" class="p-button-outlined" (click)="goBack()" style="margin-top: 1rem;"></button>
  </div>

  <!-- Store Content -->
  <div *ngIf="!loading && !error && store">
    <!-- Store Header -->
    <div class="store-header">
      <div class="store-title">
        <h1>Store {{ store.storeid }}</h1>
        <span class="store-location">{{ store.city }}, {{ store.state }}</span>
      </div>
      <div class="store-actions">
        <button pButton type="button"
                icon="pi pi-map-marker"
                label="Open in Maps"
                class="p-button-outlined"
                (click)="openInMaps(store.latitude, store.longitude)">
        </button>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section" *ngIf="storePerformance && chartsReady">
      <h2>Store Performance Overview</h2>
      <div class="charts-grid">
        <!-- Revenue Display -->
        <p-card class="chart-card fancy-number-card">
          <ng-template pTemplate="content">
            <div class="fancy-number-display">
              <div class="fancy-number-icon">
                <i class="pi pi-dollar"></i>
              </div>
              <div class="fancy-number-content">
                <div class="fancy-number-value">
                  {{ formatCurrency(storePerformance.totalRevenue) }}
                </div>
                <div class="fancy-number-label">Total Revenue</div>
              </div>
            </div>
          </ng-template>
        </p-card>

        <!-- Orders Display -->
        <p-card class="chart-card fancy-number-card">
          <ng-template pTemplate="content">
            <div class="fancy-number-display">
              <div class="fancy-number-icon">
                <i class="pi pi-shopping-cart"></i>
              </div>
              <div class="fancy-number-content">
                <div class="fancy-number-value">
                  {{ formatNumber(storePerformance.totalOrders) }}
                </div>
                <div class="fancy-number-label">Total Orders</div>
              </div>
            </div>
          </ng-template>
        </p-card>

        <!-- Performance Metrics Chart -->
        <p-card class="chart-card full-width" *ngIf="performanceChartOptions">
          <ng-template pTemplate="content">
            <apx-chart
              [series]="performanceChartOptions.series!"
              [chart]="performanceChartOptions.chart!"
              [labels]="performanceChartOptions.labels!"
              [dataLabels]="performanceChartOptions.dataLabels!"
              [plotOptions]="performanceChartOptions.plotOptions!"
              [colors]="performanceChartOptions.colors!"
              [title]="performanceChartOptions.title!"
              [legend]="performanceChartOptions.legend!">
            </apx-chart>
          </ng-template>
        </p-card>
      </div>
    </div>

    <!-- Store Comparison Charts Section -->
    <div class="charts-section" *ngIf="storePerformance && chartsReady">
      <h2>Store Comparison Charts</h2>
      <div class="comparison-legend">
        <div class="legend-item">
          <span class="legend-color" style="background-color: #10B981;"></span>
          <span>Top Performers (Green)</span>
        </div>
        <div class="legend-item">
          <span class="legend-color" style="background-color: #F59E0B;"></span>
          <span>Average Performers (Yellow)</span>
        </div>
        <div class="legend-item">
          <span class="legend-color" style="background-color: #EF4444;"></span>
          <span>Poor Performers (Red)</span>
        </div>
        <div class="legend-item">
          <span class="legend-color" style="background-color: #3B82F6;"></span>
          <span>Current Store (Blue)</span>
        </div>
      </div>
      <div class="charts-grid">
        <!-- Revenue Comparison Chart -->
        <p-card class="chart-card" *ngIf="revenueComparisonChartOptions">
          <ng-template pTemplate="content">
            <apx-chart
              [series]="revenueComparisonChartOptions.series!"
              [chart]="revenueComparisonChartOptions.chart!"
              [xaxis]="revenueComparisonChartOptions.xaxis!"
              [yaxis]="revenueComparisonChartOptions.yaxis!"
              [dataLabels]="revenueComparisonChartOptions.dataLabels!"
              [tooltip]="revenueComparisonChartOptions.tooltip!"
              [title]="revenueComparisonChartOptions.title!"
              [colors]="revenueComparisonChartOptions.colors!"
              [plotOptions]="revenueComparisonChartOptions.plotOptions!">
            </apx-chart>
          </ng-template>
        </p-card>

        <!-- Orders Comparison Chart -->
        <p-card class="chart-card" *ngIf="ordersComparisonChartOptions">
          <ng-template pTemplate="content">
            <apx-chart
              [series]="ordersComparisonChartOptions.series!"
              [chart]="ordersComparisonChartOptions.chart!"
              [xaxis]="ordersComparisonChartOptions.xaxis!"
              [yaxis]="ordersComparisonChartOptions.yaxis!"
              [dataLabels]="ordersComparisonChartOptions.dataLabels!"
              [tooltip]="ordersComparisonChartOptions.tooltip!"
              [title]="ordersComparisonChartOptions.title!"
              [colors]="ordersComparisonChartOptions.colors!"
              [plotOptions]="ordersComparisonChartOptions.plotOptions!">
            </apx-chart>
          </ng-template>
        </p-card>

        <!-- Performance Comparison Chart -->
        <p-card class="chart-card full-width" *ngIf="performanceComparisonChartOptions">
          <ng-template pTemplate="content">
            <apx-chart
              [series]="performanceComparisonChartOptions.series!"
              [chart]="performanceComparisonChartOptions.chart!"
              [xaxis]="performanceComparisonChartOptions.xaxis!"
              [yaxis]="performanceComparisonChartOptions.yaxis!"
              [dataLabels]="performanceComparisonChartOptions.dataLabels!"
              [stroke]="performanceComparisonChartOptions.stroke!"
              [fill]="performanceComparisonChartOptions.fill!"
              [tooltip]="performanceComparisonChartOptions.tooltip!"
              [title]="performanceComparisonChartOptions.title!"
              [colors]="performanceComparisonChartOptions.colors!">
            </apx-chart>
          </ng-template>
        </p-card>
      </div>
    </div>

    <!-- Charts Loading Placeholder -->
    <div class="charts-section" *ngIf="storePerformance && !chartsReady">
      <h2>Store Performance Charts</h2>
      <div class="charts-grid">
        <p-card class="chart-card" *ngFor="let i of [1,2,3]">
          <ng-template pTemplate="content">
            <div class="chart-loading">
              <i class="pi pi-spin pi-spinner" style="font-size: 2rem; color: #ff6b35;"></i>
              <div>Loading chart...</div>
            </div>
          </ng-template>
        </p-card>
      </div>
    </div>

    <!-- Store Information Grid -->
    <div class="store-info-grid">
      <!-- Store Details Card -->
      <p-card>
        <ng-template pTemplate="header">
          <h3>Store Information</h3>
        </ng-template>
        <ng-template pTemplate="content">
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Store ID:</span>
              <span class="info-value">{{ store.storeid }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">City:</span>
              <span class="info-value">{{ store.city }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">State:</span>
              <span class="info-value">{{ store.state }} ({{ store.state_abbr }})</span>
            </div>
            <div class="info-item">
              <span class="info-label">Zip Code:</span>
              <span class="info-value">{{ store.zipcode }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Coordinates:</span>
              <span class="info-value coordinates-link"
                    (click)="openInMaps(store.latitude, store.longitude)"
                    pTooltip="Click to open in Google Maps">
                {{ formatCoordinates(store.latitude, store.longitude) }}
              </span>
            </div>
          </div>
        </ng-template>
      </p-card>

      <!-- Store Statistics Card -->
      <p-card *ngIf="storeStats">
        <ng-template pTemplate="header">
          <h3>Store Performance</h3>
        </ng-template>
        <ng-template pTemplate="content">
          <div class="stats-grid">
            <div class="stat-item">
              <span class="stat-number">{{ formatNumber(storeStats.totalOrders) }}</span>
              <span class="stat-label">Total Orders</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">{{ formatCurrency(storeStats.totalRevenue) }}</span>
              <span class="stat-label">Total Revenue</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">{{ formatCurrency(storeStats.avgOrderValue) }}</span>
              <span class="stat-label">Avg Order Value</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">{{ formatNumber(storeStats.uniqueCustomers) }}</span>
              <span class="stat-label">Unique Customers</span>
            </div>
          </div>
          <div class="last-updated" *ngIf="storeStats.lastUpdated">
            <small>Last updated: {{ storeStats.lastUpdated | date:'medium' }}</small>
          </div>
        </ng-template>
      </p-card>

      <!-- Top Products Card -->
      <p-card *ngIf="storeStats?.topProducts">
        <ng-template pTemplate="header">
          <h3>Top Products ({{ storeStats?.topProducts?.length || 0 }})</h3>
        </ng-template>
        <ng-template pTemplate="content">
          <div class="products-list">
            <div class="product-item" *ngFor="let product of storeStats.topProducts; let i = index">
              <span class="product-rank">#{{ i + 1 }}</span>
              <span class="product-name" [class.no-data]="product.name === 'No data available'">
                {{ product.name }}<span *ngIf="product.size"> ({{ product.size }})</span>
                <span *ngIf="product.total_sold !== undefined && product.total_sold !== null"> - Sold: {{ product.total_sold }}</span>
              </span>
            </div>
            <div *ngIf="!storeStats.topProducts || storeStats.topProducts.length === 0" class="no-data">
              No top products data available
            </div>
          </div>
        </ng-template>
      </p-card>

      <!-- Worst Products Card -->
      <p-card *ngIf="storeStats?.worstProducts">
        <ng-template pTemplate="header">
          <h3>Worst Products ({{ storeStats?.worstProducts?.length || 0 }})</h3>
        </ng-template>
        <ng-template pTemplate="content">
          <div class="products-list">
            <div class="product-item" *ngFor="let product of storeStats.worstProducts; let i = index">
              <span class="product-rank worst">#{{ i + 1 }}</span>
              <span class="product-name" [class.no-data]="product.name === 'No data available'">
                {{ product.name }}<span *ngIf="product.size"> ({{ product.size }})</span>
                <span *ngIf="product.total_sold !== undefined && product.total_sold !== null"> - Sold: {{ product.total_sold }}</span>
              </span>
            </div>
            <div *ngIf="!storeStats.worstProducts || storeStats.worstProducts.length === 0" class="no-data">
              No worst products data available
            </div>
          </div>
        </ng-template>
      </p-card>
    </div>
  </div>

  <!-- Store Not Found -->
  <div *ngIf="!loading && !error && !store" class="error-container">
    <i class="pi pi-exclamation-triangle" style="font-size: 2rem; color: #f44336; margin-bottom: 1rem;"></i>
    <div>Store {{ storeId }} not found</div>
    <button pButton type="button" label="Back to Stores" class="p-button-outlined" (click)="goBack()" style="margin-top: 1rem;"></button>
  </div>
</div>
