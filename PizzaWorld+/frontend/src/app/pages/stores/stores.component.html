<app-sidebar></app-sidebar>
<div class="home-section">
  <!-- Modern Upper Section -->
  <div class="stores-upper-section">
    <div class="stores-stats-row">
      <div class="fancy-total-stores-box">
        <span class="fancy-total-stores-icon"><i class="pi pi-building"></i></span>
        <span class="fancy-total-stores-info">
          <span class="fancy-total-stores-number">{{ getTotalStores() }}</span>
          <span class="fancy-total-stores-label">Total Stores</span>
        </span>
      </div>
      <div class="filtered-results-box">
        <span class="filtered-results-number">{{ getStoreCount() }}</span>
        <span class="filtered-results-label">Filtered Results</span>
      </div>
    </div>
    <div class="stores-filter-card">
      <div class="stores-filter-header">
        <span class="filter-title">Search & Filter Stores</span>
        <button pButton type="button" label="Clear Filters" 
                class="p-button-outlined p-button-sm" 
                (click)="clearFilters()"
                [disabled]="!searchTerm && !selectedState">
        </button>
      </div>
      <div class="stores-filter-fields">
        <div class="filter-field">
          <label for="search" class="filter-label">Search Stores</label>
          <span class="p-input-icon-left p-w-full">
            <i class="pi pi-search"></i>
            <input pInputText id="search" 
                   [(ngModel)]="searchTerm" 
                   (input)="onSearchChange()"
                   placeholder="Search by store ID, city, zip code, or state..."
                   class="p-w-full" />
          </span>
        </div>
        <div class="filter-field">
          <label for="state" class="filter-label">Filter by State</label>
          <p-dropdown id="state"
                     [(ngModel)]="selectedState"
                     [options]="states"
                     optionLabel="label"
                     optionValue="value"
                     placeholder="Select a state..."
                     (onChange)="onStateChange()"
                     class="p-w-full">
            <ng-template let-state pTemplate="item">
              <span *ngIf="state.value; else noFilter" class="state-badge-dropdown">[{{ state.label }}]</span>
              <ng-template #noFilter>
                <span class="state-badge-dropdown state-badge-none"><span class="none-badge-inner">None</span></span>
              </ng-template>
            </ng-template>
          </p-dropdown>
        </div>
      </div>
    </div>
  </div>

  <!-- Stores Table -->
  <p-card>
    <ng-template pTemplate="header">
      <h3>Store Locations ({{ getStoreCount() }} stores)</h3>
    </ng-template>
    <ng-template pTemplate="content">
      <ng-container *ngIf="!loading && !error; else loadingOrError">
        <div class="modern-table-container">
          <table class="modern-table">
            <thead>
              <tr>
                <th>Store ID</th>
                <th>City</th>
                <th>State</th>
                <th>Zip Code</th>
                <th>Coordinates</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let store of filteredStores" class="store-row">
                <td class="store-id">
                  <span class="store-id-text">{{ store.storeid }}</span>
                </td>
                <td class="store-city">{{ store.name }}</td>
                <td class="store-state">
                  <span class="state-badge">[{{ store.state_abbr }}]</span>
                  <span class="state-name">{{ store.state }}</span>
                </td>
                <td class="store-zip">{{ store.zipcode }}</td>
                <td class="store-coordinates">
                  <span class="coordinates-link"
                        pTooltip="Click to open in Google Maps" 
                        tooltipPosition="top"
                        (click)="openInMaps(store.latitude, store.longitude)">
                    {{ formatCoordinates(store.latitude, store.longitude) }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
          
          <div *ngIf="filteredStores.length === 0" class="no-results">
            <i class="pi pi-search"></i>
            <p>No stores found matching your criteria</p>
          </div>
        </div>
      </ng-container>
      
      <ng-template #loadingOrError>
        <div class="p-d-flex p-flex-column p-ai-center p-jc-center" style="min-height:200px;">
          <ng-container *ngIf="loading; else errorState">
            <i class="pi pi-spin pi-spinner" style="font-size: 2rem; margin-bottom: 1rem;"></i>
            <div>Loading stores data...</div>
          </ng-container>
          <ng-template #errorState>
            <i class="pi pi-exclamation-triangle" style="font-size: 2rem; color: #f44336; margin-bottom: 1rem;"></i>
            <div>Failed to load stores data</div>
            <button pButton type="button" label="Retry" class="p-button-outlined" (click)="loadStoresData()" style="margin-top: 1rem;"></button>
          </ng-template>
        </div>
      </ng-template>
    </ng-template>
  </p-card>

  <!-- Stores Growth Chart -->
  <p-card class="p-mt-4" *ngIf="storesOpts">
    <ng-template pTemplate="header">
      <h3>Store Growth Over Time</h3>
    </ng-template>
    <ng-template pTemplate="content">
      <apx-chart
        [series]="storesOpts.series"
        [chart]="storesOpts.chart"
        [xaxis]="storesOpts.xaxis"
        [yaxis]="storesOpts.yaxis"
        [stroke]="storesOpts.stroke"
        [dataLabels]="storesOpts.dataLabels"
        [tooltip]="storesOpts.tooltip">
      </apx-chart>
    </ng-template>
  </p-card>
</div>